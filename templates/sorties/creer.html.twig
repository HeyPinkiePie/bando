{% extends 'base.html.twig' %}

{% block title %}Créer une sortie{% endblock %}

{% block body %}
{#   {% set url=path('sorties_listeLieux',{id:1}) %}#}

    <script>

        function chargerLieux( idVille){

           let selectlieu=document.getElementById("choixLieux");
           selectlieu.length=0;
           // Todo Trouver le moyen de mettre le param idVille !
            fetch("{{  path('sorties_listeLieux', {'id': 1})}}")
            // fetch("http://localhost:8000/listerLieux/1")
           {#fetch("{{  url('sorties_listeLieux')}}"+"/"+idVille)#}
           {# fetch("{{  path('sorties_listeLieux',{'id:')}}"+idVille+"}")#}
                // reponse = retour de la commande précédente, puis je le transforme en JSON
                .then((reponse) => reponse.json())
                //json est donc le json récupéré, je l'ajoute dans le select
                .then((json) =>{
                    for (let lieu of json) {
                            let momOption=document.createElement('option');
                            momOption.value=lieu.id;
                            momOption.innerText = lieu.nom;
                            selectlieu.appendChild(momOption);
                    }
                });
    }
    </script>
    <h1>Créer une sortie</h1>

    {{ form_start(form) }}
    {{ form_row(form.nom) }}
    {{ form_row(form.debutSortie) }}
    <label for="duree" >Durée</label><input type="number" id="duree" name="duree" min="30"  step="10">minutes
    {{ form_row(form.dateLimiteInscription) }}
    {{ form_row(form.nombreInscriptionsMax) }}
    {{ form_row(form.infosSortie) }}
    {{ form_row(form.campus) }}

    <label for="choixVille"> Ville
        <select id="choixVille" name="choixVille" onchange="chargerLieux(value)">
                <option  disabled selected>choisissez une ville:</option>
            {% for ville in villes %}
                <option value="{{ ville.id }}"> {{ ville.nom }}</option>
            {% endfor %}
        </select>
    </label>

    <label for="choixLieux"> Lieu
        <select id="choixLieux" name="choixLieux">
        </select>
    </label>

    <button type="submit" class="btn btn-primary">Créer</button>
    {{ form_end(form) }}
{% endblock %}


